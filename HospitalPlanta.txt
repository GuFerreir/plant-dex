// node --version # Should be >= 18
// npm install @google/generative-ai

const {
  GoogleGenerativeAI,
  HarmCategory,
  HarmBlockThreshold,
} = require("@google/generative-ai");

const MODEL_NAME = "gemini-1.5-pro-latest";
const API_KEY = "YOUR_API_KEY";

async function runChat() {
  const genAI = new GoogleGenerativeAI(API_KEY);
  const model = genAI.getGenerativeModel({ model: MODEL_NAME });

  const generationConfig = {
    temperature: 1,
    topK: 0,
    topP: 0.95,
    maxOutputTokens: 8192,
  };

  const safetySettings = [
    {
      category: HarmCategory.HARM_CATEGORY_HARASSMENT,
      threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
    },
    {
      category: HarmCategory.HARM_CATEGORY_HATE_SPEECH,
      threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
    },
    {
      category: HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,
      threshold: HarmBlockThreshold.BLOCK_LOW_AND_ABOVE,
    },
    {
      category: HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,
      threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,
    },
  ];

  const chat = model.startChat({
    generationConfig,
    safetySettings,
    history: [
      {
        role: "user",
        parts: [{ text: "Vou enviar uma imagem e quero que retorne um diagnostico dessa planta. Se Ã© uma planta saudÃ¡vel, ou se apresneta alguma praga ou doenÃ§a ou problema e como solucionar esse problema.\n\nO modelo da resposta deve ser:\n\nFrase descrevendo qual o problema da planta. \n\nPequeno paragrafo com aÃ§Ã£o de como resolver.\n\n__________________________________________________________________________________________________________\nExemplo:\n\n"}],
      },
      {
        role: "user",
        parts: [{ text: "\n\nSua plantinha aparenta estar com Cochonilhas ou pulgÃµes ğŸ¤’\n\nEssas sÃ£o as pragas sugadoras mais comuns no jardim. \nSe vocÃª notar que as folhas estÃ£o enrugadas e com casquinhas pretas ou manchas brancas, Ã© sinal de que a planta estÃ¡ sendo atacada por um destes dois insetos. AlÃ©m de roubarÂ nutrientes, eles liberam um tipo de cera doce que facilita o ataque de fungos e atrai formigas.Existem inÃºmeras soluÃ§Ãµes caseiras para tratar sua plantinha, mas tome cuidado com os inseticidas.\n\n________________________________________________________________________\n\n"}],
      },
      {
        role: "model",
        parts: [{ text: "Sua planta aparenta estar com podridÃ£o ğŸ¤•\n\nA podridÃ£o geralmente Ã© um sintoma de rega excessiva, mas tambÃ©m pode ser causada por fungos ou bactÃ©rias. Verifique se o solo estÃ¡ muito Ãºmido e, se estiver, deixe secar antes de regar novamente. VocÃª tambÃ©m pode tentar usar um fungicida ou bactericida para tratar a planta. Se a podridÃ£o for grave, pode ser necessÃ¡rio descartar a planta."}],
      },
      {
        role: "model",
        parts: [{ text: "Sua orquÃ­dea parece estar com uma infestaÃ§Ã£o de Ã¡caros ğŸ˜«.\n\nOs Ã¡caros sÃ£o pragas minÃºsculas que se alimentam da seiva das plantas, causando manchas amareladas, pintinhas pretas e enfraquecimento. Para tratar, isole a orquÃ­dea das outras plantas. Lave as folhas com Ã¡gua e sabÃ£o neutro, esfregando delicadamente. VocÃª tambÃ©m pode aplicar um inseticida especÃ­fico para Ã¡caros, seguindo as instruÃ§Ãµes do fabricante. Certifique-se de aumentar a umidade ao redor da planta, pois Ã¡caros preferem ambientes secos."}],
      },
      {
        role: "model",
        parts: [{ text: "Sua planta parece estar com folhas mastigadas por insetos!ğŸ›\n\nPara resolver esse problema, primeiro identifique o inseto. Observe cuidadosamente as folhas e o caule da planta em busca de sinais de insetos, como ovos, teias ou os prÃ³prios insetos. Depois de identificar o culpado, vocÃª pode tomar medidas para removÃª-los, como: aplicar inseticidas naturais, como Ã³leo de neem ou sabÃ£o inseticida; usar armadilhas adesivas para capturar insetos voadores; ou remover manualmente os insetos e suas larvas.  Lembre-se de verificar regularmente se hÃ¡ novas infestaÃ§Ãµes e agir rapidamente para proteger sua planta! ğŸ’ª"}],
      },
      {
        role: "model",
        parts: [{ text: "Sua planta aparenta estar com formigas ğŸœ\n\nAs formigas em si nÃ£o costumam ser um problema para as plantas, mas podem indicar a presenÃ§a de outras pragas, como pulgÃµes ou cochonilhas. As formigas se alimentam da substÃ¢ncia aÃ§ucarada produzida por essas pragas, entÃ£o a presenÃ§a delas pode indicar um problema maior. Inspecione sua planta cuidadosamente em busca de sinais de pulgÃµes, cochonilhas ou outras pragas. Se encontrar alguma infestaÃ§Ã£o, trate-a adequadamente. Eliminar a fonte de alimento das formigas ajudarÃ¡ a mantÃª-las afastadas."}],
      },
      {
        role: "model",
        parts: [{ text: "Sua violeta africana estÃ¡ linda e saudÃ¡vel! ğŸŒ¸ \n\nAs folhas estÃ£o verdes e vibrantes, e as flores estÃ£o florescendo lindamente. Continue cuidando bem dela, garantindo luz indireta brilhante, rega adequada e um ambiente Ãºmido.  ğŸ‘"}],
      },
      {
        role: "model",
        parts: [{ text: "Erro: uma planta por vez"}],
      },
      {
        role: "model",
        parts: [{ text: "Erro: uma planta por vez"}],
      },
      {
        role: "model",
        parts: [{ text: "Seu alecrim parece estar saudÃ¡vel! ğŸ˜Š\n\nAs folhas estÃ£o verdes e vibrantes, e os caules estÃ£o firmes. Continue cuidando bem dele, garantindo bastante luz solar, solo bem drenado e regas adequadas. ğŸ‘"}],
      },
      {
        role: "model",
        parts: [{ text: "Sua plantinha aparenta estar com Cochonilhas ou pulgÃµes ğŸ¤’\n\nEssas sÃ£o as pragas sugadoras mais comuns no jardim. \nSe vocÃª notar que as folhas estÃ£o enrugadas e com casquinhas pretas ou manchas brancas, Ã© sinal de que a planta estÃ¡ sendo atacada por um destes dois insetos. AlÃ©m de roubarÂ nutrientes, eles liberam um tipo de cera doce que facilita o ataque de fungos e atrai formigas.Existem inÃºmeras soluÃ§Ãµes caseiras para tratar sua plantinha, mas tome cuidado com os inseticidas."}],
      },
      {
        role: "model",
        parts: [{ text: "Erro: planta nÃ£o identificada"}],
      },
      {
        role: "model",
        parts: [{ text: "Seu girassol estÃ¡ lindo e saudÃ¡vel! ğŸŒ»\n\nSuas pÃ©talas sÃ£o vibrantes e o caule estÃ¡ forte, demonstrando que estÃ¡ recebendo bastante luz solar e nutrientes. Continue com os cuidados, fornecendo Ã¡gua suficiente e um ambiente propÃ­cio para seu florescimento. ParabÃ©ns! ğŸ‰"}],
      },
      {
        role: "model",
        parts: [{ text: "Seu lÃ­rio estÃ¡ espetacular e cheio de vida! ğŸ¤©\n\nAs flores estÃ£o abertas e com cores vibrantes, e as folhas estÃ£o verdes e saudÃ¡veis. Continue cuidando bem dele, garantindo luz solar indireta, solo bem drenado e regas regulares.  ğŸ‘"}],
      },
    ],
  });

  const result = await chat.sendMessage("YOUR_USER_INPUT");
  const response = result.response;
  console.log(response.text());
}

runChat();